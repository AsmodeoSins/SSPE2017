<UserControl x:Class="ControlPenales.BitacoraIngresosEgresosHospitalizacionView"
             x:Name="BitacoraHospitalizacionWindow"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             xmlns:cmd="http://www.galasoft.ch/mvvmlight"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
             xmlns:Views="clr-namespace:ControlPenales"
             xmlns:local="clr-namespace:ControlPenales"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:actb="clr-namespace:ControlPenales.Controls"
             xmlns:sys="clr-namespace:System;assembly=mscorlib">

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding WindowLoading}" CommandParameter="{Binding ElementName=BitacoraHospitalizacionWindow}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <UserControl.Resources>
        <Views:GetPersonaNombre x:Key="ConvertirPersonaNombre" />
        <Views:DateConverter x:Key="ConvertirFechaEdad"/>
        <Style TargetType="CheckBox">
            <Setter Property="BorderBrush" Value="Gray" />
            <Setter Property="BorderThickness" Value="2" />
        </Style>
        <Views:MultiValueConverter x:Key="MultiParamConverter"></Views:MultiValueConverter>
        <Views:TrimStringConverter x:Key="Trimming" />
        <Views:AutocompleteViewModel x:Key="vm" />
        <CollectionViewSource x:Key="xml">
            <CollectionViewSource.Source>
                <PriorityBinding>
                    <Binding Source="{StaticResource vm}" Path="QueryCollection" IsAsync="True"/>
                    <Binding Source="{StaticResource vm}" Path="WaitMessage"/>
                </PriorityBinding>
            </CollectionViewSource.Source>
        </CollectionViewSource>
        <CollectionViewSource x:Key="receta">
            <CollectionViewSource.Source>
                <PriorityBinding>
                    <Binding Source="{StaticResource vm}" Path="QueryReceta" IsAsync="True"/>
                    <Binding Source="{StaticResource vm}" Path="WaitMessage"/>
                </PriorityBinding>
            </CollectionViewSource.Source>
        </CollectionViewSource>
        <Views:MyDataTemplateSelector x:Key="TemplateSelector"/>
        <DataTemplate x:Key="TheItemTemplate">
            <Border CornerRadius="5" BorderBrush="#427399" BorderThickness="3" Background="Transparent" HorizontalAlignment="Stretch" Grid.ColumnSpan="2" ScrollViewer.VerticalScrollBarVisibility="Visible">
                <Grid HorizontalAlignment="Left" Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal" Grid.Column="0" Margin="2" HorizontalAlignment="Left">
                        <TextBlock Text="CLAVE:  "/>
                        <TextBlock Text="{Binding CLAVE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="NOMBRE:  "/>
                        <TextBlock Text="{Binding NOMBRE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="TheItemTemplateReceta">
            <Border CornerRadius="5" BorderBrush="#427399" BorderThickness="3" Background="Transparent" HorizontalAlignment="Stretch" Grid.ColumnSpan="2" ScrollViewer.VerticalScrollBarVisibility="Visible">
                <Grid HorizontalAlignment="Left" Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <!--<ColumnDefinition Width="300"></ColumnDefinition>-->
                        <ColumnDefinition></ColumnDefinition>
                        <ColumnDefinition Width="250"></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <!--<StackPanel Orientation="Horizontal" Grid.Column="0" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="CATEGORIA:  "/>
                        <TextBlock Text="{Binding PRODUCTO.PRODUCTO_CATEGORIA.NOMBRE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>-->
                    <StackPanel Orientation="Horizontal" Grid.Column="0" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="PRODUCTO:  "/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Width="225" Text="{Binding PRODUCTO.NOMBRE, Converter={StaticResource Trimming}}" TextWrapping="Wrap" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Column="2" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="FORMA FARM.:  "/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Column="3" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="{Binding PRODUCTO.FORMA_FARMACEUTICA.DESCR, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="WaitTemplate">
            <TextBlock Text="{Binding}" Background="SlateBlue"/>
        </DataTemplate>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>

        <Views:MenuBitacoraIngresosEgresosHospitalizacionView Margin="50 0 0 0"/>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions >
                <ColumnDefinition />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <StackPanel>
                <TextBlock Text="Bitácora de Hospitalización" FontSize="20"/>
                <TextBlock Text="Servicio: HOSPITALIZACIÓN"/>
            </StackPanel>


            <GroupBox Grid.Column="1" HorizontalAlignment="Right" Header="Disponibilidad de Camas">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Margin="0 0 10 0" Text="{Binding CamasOcupadas}"/>
                    <TextBlock Margin="10 0 0 0" Text="{Binding CamasDesocupadas}"/>
                </StackPanel>
            </GroupBox>

        </Grid>
        <GroupBox Grid.Row="2" Header="{Binding TituloGroupBoxHospitalizaciones}">
            <StackPanel>
                <StackPanel Orientation="Horizontal" >
                    <TextBlock Text="Fecha:" VerticalAlignment="Center" Margin="0 0 10 0"/>
                    <DatePicker Margin="0 10 0 10" HorizontalAlignment="Left" Controls:TextBoxHelper.Watermark="Seleccione una fecha" SelectedDate="{Binding SelectedFechaHospitalizacion}" IsEnabled="{Binding IsBuscarporFechaEnabled}" DisplayDateEnd="{Binding FechaServer}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="SelectedDateChanged">
                                <i:InvokeCommandAction Command="{Binding HospitalizacionesPorFecha}" CommandParameter="{Binding ElementName=BitacoraHospitalizacionWindow}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </DatePicker>
                </StackPanel>
                <Label Content=" " x:Name="lbAncho"/>
                <ScrollViewer Width="{Binding ActualWidth, ConverterParameter=x-1, Converter={Views:MathConverter}, ElementName=lbAncho}" HorizontalAlignment="Left">
                    <DataGrid  Style="{StaticResource MetroDataGrid}" ItemsSource="{Binding ListaHospitalizaciones}" SelectedItem="{Binding SelectedHospitalizacion}" AutoGenerateColumns="False" IsReadOnly="True" ScrollViewer.VerticalScrollBarVisibility="Auto" MaxHeight="300" SelectionMode="Single">
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="{Binding OnClick}" Header="Alta" CommandParameter="alta_hospitalizacion"></MenuItem>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Cama" Binding="{Binding CAMA_HOSPITAL.DESCR}"/>
                            <DataGridTextColumn Header="Año" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.ID_ANIO}"/>
                            <DataGridTextColumn Header="Folio" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.ID_IMPUTADO}"/>
                            <DataGridTextColumn Header="Nombre" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.IMPUTADO.NOMBRE}"/>
                            <DataGridTextColumn Header="Paterno" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.IMPUTADO.PATERNO}"/>
                            <DataGridTextColumn Header="Materno" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.IMPUTADO.MATERNO}"/>
                            <DataGridTextColumn Header="Edad" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.IMPUTADO.NACIMIENTO_FECHA,Converter={StaticResource ConvertirFechaEdad}}"/>
                            <DataGridTextColumn Header="Médico que ingresa" Binding="{Binding USUARIO.EMPLEADO.PERSONA,Converter={StaticResource ConvertirPersonaNombre}}"/>
                            <DataGridTextColumn Header="Fecha de Ingreso" Binding="{Binding INGRESO_FEC}"/>
                            <DataGridTextColumn Header="Tipo Hospitalización" Binding="{Binding HOSPITALIZACION_INGRESO_TIPO.DESCR}"/>
                            <DataGridTextColumn Header="Medico que da de alta" Binding="{Binding EMPLEADO1.PERSONA, Converter={StaticResource ConvertirPersonaNombre}}"></DataGridTextColumn>
                            <DataGridTextColumn Header="Fecha da de alta" Binding="{Binding ALTA_FEC, StringFormat=dd/MM/yyyy hh:mm tt}"></DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>                
            </StackPanel>

        </GroupBox>
        <Controls:MetroAnimatedSingleRowTabControl  Controls:TabControlHelper.IsUnderlined="True" SelectedIndex="{Binding IndexTab}"  Grid.Row="3">
            <TabItem Style="{StaticResource HeaderTabStyle}" Header="Ingreso Hospitalización">
                <GroupBox IsEnabled="{Binding IngresoHospitalizacionEnabled}" Header="Ingreso Hospitalización">
                    <Grid Margin="10 0 0 0">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition />
                            <ColumnDefinition Width=".18*"/>
                        </Grid.ColumnDefinitions>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto"/>
                                <ColumnDefinition Width="auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />

                            </Grid.RowDefinitions>

                            <TextBlock Text="Origen"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding ListaTipoHospitalizaciones}" SelectedValue="{Binding SelectedTipoHospitalizacionValue,ValidatesOnDataErrors=True}" DisplayMemberPath="DESCR" SelectedValuePath="ID_INGHOSTIP" Height="26" VerticalAlignment="Top"></ComboBox>
                            <TextBlock Text="Cama" Grid.Row="1"/>
                            <ComboBox Grid.Row="1" Grid.Column="1" ItemsSource="{Binding ListaCamasHospitalizacion}" SelectedValue="{Binding SelectedCamaHospitalValue,ValidatesOnDataErrors=True}"  DisplayMemberPath="DESCR" SelectedValuePath="ID_CAMA_HOSPITAL"/>

                            <TextBlock Text="Fecha" Grid.Row="2"/>
                            <xctk:DateTimePicker Grid.Column="1" Grid.Row="2" Format="Custom" FormatString="dd/MM/yyyy hh:mm tt" Watermark="Seleccione una fecha" Minimum="{Binding FechaMinimaHospitalizacion,UpdateSourceTrigger=PropertyChanged}" Maximum="{Binding FechaMaximaHospitalizacion,UpdateSourceTrigger=PropertyChanged}" 
                                                 Text="{Binding HospitalizacionFecha,StringFormat=dd/MM/yyyy hh:mm tt,ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged,NotifyOnSourceUpdated=True}"/>
                            <TextBlock Text="Médico" Grid.Row="3" />
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding UsuarioAreaMedica}" IsReadOnly="True"/>
                        </Grid>
                        <Grid Grid.Column="1" Grid.ColumnSpan="2" HorizontalAlignment="Right">
                            <Grid.RowDefinitions>
                                <RowDefinition Height=".5*"/>
                                <RowDefinition />
                            </Grid.RowDefinitions>

                            <Button Style="{DynamicResource AccentedSquareButtonStyle}" Command="{Binding OnClick}" CommandParameter="NotasMedicasHospitalizacion" Content="Buscar Notas médicas" Grid.Column="1" VerticalAlignment="Top"  Width="150" Height="30" />
                            <!--<Button IsEnabled="{Binding NotaMedicaSelected}" Grid.Row="1" Style="{DynamicResource AccentedSquareButtonStyle}" Command="{Binding OnClick}" CommandParameter="ConfirmarHospitalizacion" Content="Confirmar Hospitalización" Grid.Column="1" VerticalAlignment="Top"  Width="150" Height="30" />-->

                        </Grid>
                        <TextBlock Margin="0 20 0 0" Grid.Row="1" Grid.ColumnSpan="2" FontSize="20" Text="Datos de Ingreso"/>
                        <Grid Grid.Row="2" Grid.ColumnSpan="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition Width="5*"/>
                            </Grid.ColumnDefinitions>
                            <GroupBox  Header="No. Expediente">
                                <Grid>
                                    <Grid.Style>
                                        <Style TargetType="Grid">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ElementName=AnioHospitalizacion, Path=Text.Length}" Value="4">
                                                    <Setter Property="FocusManager.FocusedElement" Value="{Binding ElementName=FolioHospitalizacion}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Grid.Style>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="0.5*"/>
                                        <ColumnDefinition Width="auto"/>
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="Año"/>
                                    <TextBlock Grid.Column="2" Text="Folio"/>

                                    <TextBox Grid.Row="1" Name="AnioHospitalizacion" Text="{Binding AnioHospitalizacion}" IsEnabled="{Binding BusquedaAvanzadaChecked,UpdateSourceTrigger=PropertyChanged,NotifyOnSourceUpdated=True}" >
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]+$" MaxLength="4" />
                                        </i:Interaction.Behaviors>
                                        <TextBox.InputBindings>
                                            <KeyBinding  Command="{Binding OnClick}" CommandParameter="NotasMedicasHospitalizacion" Key="Enter" />
                                        </TextBox.InputBindings>
                                    </TextBox>
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="/" HorizontalAlignment="Center"/>
                                    <TextBox Name="FolioHospitalizacion" Text="{Binding FolioHospitalizacion}" Grid.Row="1" Grid.Column="2" IsEnabled="{Binding BusquedaAvanzadaChecked,UpdateSourceTrigger=PropertyChanged,NotifyOnSourceUpdated=True,Mode=TwoWay}" >
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]+$" MaxLength="6" />
                                        </i:Interaction.Behaviors>
                                        <TextBox.InputBindings>
                                            <KeyBinding  Command="{Binding OnClick}" CommandParameter="NotasMedicasHospitalizacion" Key="Enter" />
                                        </TextBox.InputBindings>
                                    </TextBox>
                                </Grid>
                            </GroupBox>
                            <GroupBox Grid.Column="1"  Header="Nombre">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>


                                    <TextBlock Text="Apellido Paterno" />
                                    <TextBlock Text="Apellido Materno" Grid.Column="1"/>
                                    <TextBlock Text="Nombre" Grid.Column="2"/>
                                    <TextBox Name="ApellidoPaternoHospitalizacion" Text="{Binding ApellidoPaternoHospitalizacion}" CharacterCasing="Upper" Grid.Row="1" IsEnabled="{Binding BusquedaAvanzadaChecked,UpdateSourceTrigger=PropertyChanged,NotifyOnSourceUpdated=True}" >
                                        <TextBox.InputBindings>
                                            <KeyBinding  Command="{Binding OnClick}" CommandParameter="NotasMedicasHospitalizacion" Key="Enter" />
                                        </TextBox.InputBindings>
                                        <i:Interaction.Behaviors>
                                            <local:AllowableCharactersTextBoxBehavior RegularExpression="^[a-zA-ZñÑ]*$" MaxLength="40"  />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                    <TextBox Name="ApellidoMaternoHospitalizacion" Text="{Binding ApellidoMaternoHospitalizacion}" CharacterCasing="Upper" Grid.Column="1" Grid.Row="1" IsEnabled="{Binding BusquedaAvanzadaChecked,UpdateSourceTrigger=PropertyChanged,NotifyOnSourceUpdated=True}" >
                                        <TextBox.InputBindings>
                                            <KeyBinding  Command="{Binding OnClick}" CommandParameter="NotasMedicasHospitalizacion" Key="Enter" />
                                        </TextBox.InputBindings>
                                        <i:Interaction.Behaviors>
                                            <local:AllowableCharactersTextBoxBehavior RegularExpression="^[a-zA-ZñÑ]*$" MaxLength="40"  />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                    <TextBox Name="NombreHospitalizacion" Text="{Binding NombreHospitalizacion}" CharacterCasing="Upper" Grid.Column="2" Grid.Row="1" IsEnabled="{Binding BusquedaAvanzadaChecked,UpdateSourceTrigger=PropertyChanged,NotifyOnSourceUpdated=True}" >
                                        <TextBox.InputBindings>
                                            <KeyBinding  Command="{Binding OnClick}" CommandParameter="NotasMedicasHospitalizacion" Key="Enter" />
                                        </TextBox.InputBindings>
                                        <i:Interaction.Behaviors>
                                            <local:AllowableCharactersTextBoxBehavior RegularExpression="^[a-zA-ZñÑ]*$" MaxLength="40"  />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                </Grid>
                            </GroupBox>

                        </Grid>
                        <Image Source="{Binding FotoIngresoNotaMedica}" Width="120" Grid.Row="1" Grid.Column="2" Grid.RowSpan="2"></Image>
                    </Grid>
                </GroupBox>
            </TabItem>
            <TabItem Style="{StaticResource HeaderTabStyle}" Header="Egreso Hospitalización">
                <Grid IsEnabled="{Binding IsNotaEgresoEnabled}">
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <GroupBox Header="Datos del Imputado">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"></ColumnDefinition>
                                <ColumnDefinition Width="150"></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto"></RowDefinition>
                                    <RowDefinition Height="auto"></RowDefinition>
                                </Grid.RowDefinitions>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                        <ColumnDefinition Width="auto"></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Folio"></Label>
                                    <TextBox Grid.Row="1" Text="{Binding TextAnioImputadoEgreso,UpdateSourceTrigger=PropertyChanged,TargetNullValue=''}"  CharacterCasing="Upper" MaxLength="4" 
                         IsReadOnly="True" Margin="0 0 10 0" Width="50">
                                    </TextBox>
                                    <Label Grid.Column="1" Grid.Row="1" Margin="-7.5,0,0,0" >/</Label>
                                    <Label Content="Año" Grid.Column="1"></Label>
                                    <TextBox Grid.Column="1" Grid.Row="1" Text="{Binding TextFolioImputadoEgreso,UpdateSourceTrigger=PropertyChanged,TargetNullValue=''}" CharacterCasing="Upper" MaxLength="5" 
                         IsReadOnly="True" Margin="10 0 0 0" Width="50">
                                    </TextBox>
                                    <Label Content="Apellido Paterno" Grid.Column="2"></Label>
                                    <TextBox Grid.Column="2" Grid.Row="1" Text="{Binding TextPaternoImputadoEgreso,UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper" 
                         MaxLength="30" IsReadOnly="True">
                                    </TextBox>
                                    <Label Content="Apellido Materno" Grid.Column="3"></Label>
                                    <TextBox Grid.Column="3" Grid.Row="1" Text="{Binding TextMaternoImputadoEgreso, UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper"  
                         MaxLength="30" IsReadOnly="True">
                                    </TextBox>
                                    <Label Content="Nombre" Grid.Column="4"></Label>
                                    <TextBox Grid.Column="4" Grid.Row="1" Text="{Binding TextNombreImputadoEgreso, UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper" MaxLength="40" 
                         IsReadOnly="True">
                                    </TextBox>
                                </Grid>
                                <Grid Grid.Row="1">
                                    <Grid.RowDefinitions>
                                        <RowDefinition></RowDefinition>
                                        <RowDefinition></RowDefinition>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    <Label Content="Sexo"></Label>
                                    <Label Content="Edad" Grid.Column="1"></Label>
                                    <Label Content="Cama" Grid.Column="2"></Label>
                                    <TextBox Grid.Row="1" IsReadOnly="True" 
                                        Text="{ Binding TextSexoImputadoEgreso, UpdateSourceTrigger=PropertyChanged }"></TextBox>
                                    <TextBox Grid.Column="1" Grid.Row="1" IsReadOnly="True" Text="{Binding TextEdadImputadoEgreso}"></TextBox>
                                    <TextBox Grid.Column="2" Grid.Row="1" IsReadOnly="True" Text="{Binding TextCamaHospitalizacionEgreso}"></TextBox>
                                </Grid>
                            </Grid>
                            <Image Grid.Column="1" Height="150" Source="{Binding ImagenIngresoEgreso}" VerticalAlignment="Stretch"  HorizontalAlignment="Stretch" ></Image>
                        </Grid>
                    </GroupBox>
                    <GroupBox Header="Datos del Egreso" Grid.Row="1">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition></RowDefinition>
                                <RowDefinition></RowDefinition>
                                <RowDefinition></RowDefinition>
                            </Grid.RowDefinitions>
                            <Label Content="Motivo de egreso"></Label>
                            <ComboBox ItemsSource="{Binding LstMotivoEgresoMedico}" SelectedValue="{Binding SelectedMotivoEgresoMedicoValue, NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay, ValidatesOnDataErrors=True}" DisplayMemberPath="DESCR" SelectedValuePath="ID_MOEGMED" Grid.Row="1" MaxWidth="200" HorizontalAlignment="Left" Width="200">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="SourceUpdated">
                                        <i:InvokeCommandAction Command="{Binding CmdModelChanged}" CommandParameter="cambio_motivo">
                                        </i:InvokeCommandAction>
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </ComboBox>
                            <GroupBox Header="Nota de Egreso" Grid.Row="2" Visibility="{Binding IsNotaEgresoVisible}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition></RowDefinition>
                                        <RowDefinition></RowDefinition>
                                        <RowDefinition></RowDefinition>
                                    </Grid.RowDefinitions>
                                    <GroupBox Header="Datos generales">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition></ColumnDefinition>
                                                <ColumnDefinition></ColumnDefinition>
                                            </Grid.ColumnDefinitions>
                                            <Label Content="Fecha y hora de ingreso"></Label>
                                            <Label Content="{Binding FechaIngresoHospitalizacion}" ContentStringFormat="dd/MM/yyyy HH:mm" Grid.Row="1"></Label>
                                            <Label Content="Diagnostico de ingreso" Grid.Column="1"></Label>
                                            <Label Content="{Binding DiagnosticoIngresoHospitalizacion}" Grid.Column="1" Grid.Row="1"></Label>
                                            <Label Content="Fecha y hora egreso" Grid.Row="2"></Label>
                                            <Border Grid.Row="3" BorderBrush="Red"  ToolTipService.IsEnabled="{Binding IsFechaEgresoValida, Converter={Views:BoolToOppositeBoolConverter}}"  
                                    Width="200" HorizontalAlignment="Left">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="BorderThickness" Value="0"/>
                                                        <Setter Property="ToolTipService.Placement" Value="Right"></Setter>
                                                        <Setter Property="ToolTipService.HorizontalOffset" Value="5"></Setter>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsFechaEgresoValida,ValidatesOnDataErrors=True}" Value="False">
                                                                <Setter Property="BorderThickness" Value="1"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <ToolTipService.ToolTip>
                                                    <ToolTip Template="{StaticResource ToolTipTemplate}">
                                                        <ToolTip.Content>
                                                            <TextBlock Text="FECHA DE DECESO ES REQUERIDA" Style="{StaticResource errorLabel}"/>
                                                        </ToolTip.Content>
                                                    </ToolTip>
                                                </ToolTipService.ToolTip>
                                                <xctk:DateTimePicker Format="Custom" FormatString="dd/MM/yyyy hh:mm tt" Watermark="Seleccione una fecha" Grid.Row="3"
                                                Text="{Binding FechaEgresoHospitalizacion,StringFormat=dd/MM/yyyy hh:mm tt,ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged, NotifyOnSourceUpdated=True}"
                                                 MinHeight="26" Maximum="{Binding FechaMaximaEgresoHospitalizacion}">
                                                    <i:Interaction.Triggers>
                                                        <i:EventTrigger EventName="SourceUpdated">
                                                            <i:InvokeCommandAction Command="{Binding CmdModelChanged}" CommandParameter="cambio_fecha_egreso">
                                                            </i:InvokeCommandAction>
                                                        </i:EventTrigger>
                                                    </i:Interaction.Triggers>
                                                </xctk:DateTimePicker>
                                            </Border>
                                            
                                            <Label Content="Dias de estancia hospitalaria" Grid.Column="1" Grid.Row="2"></Label>
                                            <Label Content="{Binding DiasHospitalizado, TargetNullValue=''}"  Grid.Column="1" Grid.Row="3"></Label>
                                        </Grid>
                                    </GroupBox>
                                    <GroupBox Header="Datos de la excarcelación" Visibility="{Binding IsExcarcelacionVisible}" Grid.Row="1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="150"></ColumnDefinition>
                                                <ColumnDefinition></ColumnDefinition>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                            </Grid.RowDefinitions>
                                            <Label Content="Fecha de la excarcelación"></Label>
                                            <Label Content="Destino(s) de la excarcelación" Grid.Column="1"></Label>
                                            <Label Content="{Binding FechaExcarcelacionEgresoHospitalizacion}" Grid.Row="1"></Label>
                                            <Label Content="{Binding DestinoExcarcelacionEgresoHospitalizacion}" Grid.Row="1" Grid.Column="1"></Label>
                                        </Grid>
                                    </GroupBox>
                                    <GroupBox Header="Datos de la liberación" Visibility="{Binding IsLiberacionVisible}" Grid.Row="1">
                                        <StackPanel>
                                            <Label Content="Folio de liberación"></Label>
                                            <Label Content="{Binding FolioLiberacion}"></Label>
                                        </StackPanel>
                                    </GroupBox>
                                    <GroupBox Header="Datos de la nota médica" Grid.Row="2">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                            </Grid.RowDefinitions>
                                            <Label Content="RESUMEN DE LA EVOLUCIÓN Y ESTADO ACTUAL"></Label>
                                            <TextBox Text="{Binding TextEvolucionEstadoActualEgresoMedico}" AcceptsReturn="True" CharacterCasing="Upper" MaxLength="2000" Height="150" Grid.Row="1"></TextBox>
                                            <GroupBox Header="Tratemiento Empleado" Grid.Row="2">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                    </Grid.RowDefinitions>
                                                    <Label Content="MEDICAMENTO"></Label>
                                                    <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding LstTratamientoMedicoHistorial}" Height="150" SelectionUnit="FullRow" IsReadOnly="True"
                                                Grid.Row="1" Name="dgRecetaMedica" Style="{StaticResource MetroDataGrid}">
                                                        <DataGrid.Columns>
                                                            <DataGridTemplateColumn Header="Medicamento" Width="200">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBlock Text="{Binding MEDICAMENTO}" TextWrapping="Wrap"></TextBlock>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTextColumn Header="Cantidad" Binding="{Binding CANTIDAD}"></DataGridTextColumn>
                                                            <DataGridTextColumn Binding="{Binding UNIDAD_MEDIDA}" Header="UNIDAD DE MEDIDA"></DataGridTextColumn>
                                                            <DataGridTextColumn Binding="{Binding PRESENTACION}" Header="PRESENTACIÓN"></DataGridTextColumn>
                                                            <DataGridTextColumn Binding="{Binding DURACION}" Header="DURACIÓN (DÍAS)"></DataGridTextColumn>
                                                            <DataGridTemplateColumn Header="Mañana">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <CheckBox IsChecked="{Binding MANANA,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" IsEnabled="False"></CheckBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Tarde">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <CheckBox IsChecked="{Binding TARDE,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" IsEnabled="False"></CheckBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Noche">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <CheckBox IsChecked="{Binding NOCHE,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" IsEnabled="False"></CheckBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Observaciones" Width="200">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBlock Text="{Binding OBSERVACIONES}" TextWrapping="Wrap"></TextBlock>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                        </DataGrid.Columns>
                                                    </DataGrid>
                                                    <Label Content="DIETA" Grid.Row="2"></Label>
                                                    <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding LstDietas}" Height="150" SelectionUnit="FullRow" IsReadOnly="True"
                                                Grid.Row="3" Style="{StaticResource MetroDataGrid}">
                                                        <DataGrid.Columns>
                                                            <DataGridTextColumn Header="Dieta" Binding="{Binding DIETA.DESCR}">
                                                            </DataGridTextColumn>
                                                        </DataGrid.Columns>
                                                    </DataGrid>
                                                    <Label Content="PROCEDIMIENTOS REALIZADOS" Grid.Row="4"></Label>
                                                    <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding LstProcedimientos}" Height="150" SelectionUnit="FullRow" IsReadOnly="True"
                                                Grid.Row="5" Style="{StaticResource MetroDataGrid}">
                                                        <DataGrid.Columns>
                                                            <DataGridTextColumn Header="PROCEDIMIENTO MEDICO" Binding="{Binding PROC_ATENCION_MEDICA.PROC_MED.DESCR}">
                                                            </DataGridTextColumn>
                                                            <DataGridTextColumn Header="FECHA" Binding="{Binding REALIZACION_FEC}">
                                                            </DataGridTextColumn>
                                                        </DataGrid.Columns>
                                                    </DataGrid>
                                                </Grid>
                                            </GroupBox>
                                            <GroupBox Header="DIAGNOSTICO FINAL" Grid.Row="3">
                                                <StackPanel Margin="1 0 3 0">
                                                    <StackPanel Orientation="Horizontal">
                                                        <Label Content="Diagnóstico"></Label>
                                                        <actb:AutoCompleteTextBox CharacterCasing="Upper" Text="{Binding Source={StaticResource vm}, Path=QueryText, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Top"
                                                  x:Name="AutoCompleteTB" MaxCompletions="10" Width="350" ItemsSource="{Binding Source={StaticResource xml}}" ItemTemplateSelector="{StaticResource TemplateSelector}" 
                                                  Binding="{Binding XPath=suggestion/@data}"/>
                                                    </StackPanel>
                                                    <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding ListEnfermedades}" SelectedItem="{Binding SelectEnfermedad}" Height="150" SelectionUnit="FullRow"
                                                        Style="{StaticResource MetroDataGrid}" Grid.Column="1" Margin="0 3 0 0" Width="{Binding ActualWidth,ConverterParameter=x-1,Converter={Views:MathConverter},ElementName=lbAnchoDiagnostico1}">
                                                        <DataGrid.Columns>
                                                            <DataGridTemplateColumn>
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBlock Text="{Binding CLAVE}">
                                                                            <TextBlock.Style>
                                                                                <Style TargetType="TextBlock">
                                                                                    <Style.Triggers>
                                                                                        <Trigger Property="IsEnabled" Value="False">
                                                                                            <Setter Property="Foreground" Value="Black"></Setter>
                                                                                        </Trigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </TextBlock.Style>
                                                                        </TextBlock>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                                <DataGridTemplateColumn.HeaderTemplate>
                                                                    <DataTemplate>
                                                                        <TextBlock Text="Clave">
                                                                            <TextBlock.Style>
                                                                                <Style TargetType="TextBlock">
                                                                                    <Setter Property="FontSize" Value="13px"></Setter>
                                                                                    <Style.Triggers>
                                                                                        <Trigger Property="IsEnabled" Value="False">
                                                                                            <Setter Property="Foreground" Value="White"></Setter>
                                                                                        </Trigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </TextBlock.Style>
                                                                        </TextBlock>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.HeaderTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn>
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBlock Text="{Binding NOMBRE}">
                                                                            <TextBlock.Style>
                                                                                <Style TargetType="TextBlock">
                                                                                    <Style.Triggers>
                                                                                        <Trigger Property="IsEnabled" Value="False">
                                                                                            <Setter Property="Foreground" Value="Black"></Setter>
                                                                                        </Trigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </TextBlock.Style>
                                                                        </TextBlock>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                                <DataGridTemplateColumn.HeaderTemplate>
                                                                    <DataTemplate>
                                                                        <TextBlock Text="Nombre">
                                                                            <TextBlock.Style>
                                                                                <Style TargetType="TextBlock">
                                                                                    <Setter Property="FontSize" Value="13px"></Setter>
                                                                                    <Style.Triggers>
                                                                                        <Trigger Property="IsEnabled" Value="False">
                                                                                            <Setter Property="Foreground" Value="White"></Setter>
                                                                                        </Trigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </TextBlock.Style>
                                                                        </TextBlock>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.HeaderTemplate>
                                                            </DataGridTemplateColumn>
                                                        </DataGrid.Columns>
                                                        <DataGrid.ContextMenu>
                                                            <ContextMenu >
                                                                <MenuItem Header="Borrar..." CommandParameter="borrar_enfermedad" Command="{Binding OnClick}" IsEnabled="{Binding BorrarEnfermedadEnabled}" />
                                                            </ContextMenu>
                                                        </DataGrid.ContextMenu>
                                                    </DataGrid>
                                                    <StackPanel Orientation="Horizontal">
                                                        <StackPanel Orientation="Horizontal">
                                                            <Label Content="Solicita Interconsulta" Margin="0 0 -5 0"></Label>
                                                            <CheckBox IsChecked="{Binding SolicitaInterconsultaCheck}" Margin="10 0 0 0" HorizontalAlignment="Center" VerticalAlignment="Center"></CheckBox>
                                                        </StackPanel>
                                                    </StackPanel>
                                                    <StackPanel  Orientation="Horizontal" VerticalAlignment="Bottom" Margin="0 5 0 5">
                                                        <Label Content="Requiere de un seguimiento médico?"></Label>
                                                        <CheckBox Margin="10 0 0 3" IsChecked="{Binding CheckedSeguimiento}" VerticalAlignment="Center" Content="Si / No"></CheckBox>
                                                        <Button HorizontalAlignment="Left" VerticalAlignment="Top" Width="150" Style="{DynamicResource AccentedSquareButtonStyle}" CommandParameter="agendar_cita" 
                                                            Command="{Binding OnClick}" Margin="10 3 0 0" IsEnabled="{Binding SeguimientoEnabled}">Agendar Cita</Button>
                                                        <Label Content="{Binding StrFechaSeguimiento}" Margin="20 3 0 0"></Label>
                                                    </StackPanel>
                                                </StackPanel>
                                            </GroupBox>
                                            <GroupBox Header="Tratamiento" Grid.Row="4">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition></ColumnDefinition>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="auto"></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition Height="auto"></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                        <RowDefinition></RowDefinition>
                                                    </Grid.RowDefinitions>
                                                    <Label Content="Medicamento" HorizontalAlignment="Stretch" Name="lbAnchoTratamiento" VerticalAlignment="Top"></Label>
                                                    <TextBox Grid.Row="1" IsEnabled="{Binding ElementosDisponibles}" CharacterCasing="Upper" TextWrapping="Wrap" ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                             VerticalAlignment="Top" Text="{Binding Recetas,UpdateSourceTrigger=PropertyChanged,ValidatesOnDataErrors=True}" Width="400" HorizontalAlignment="Left"></TextBox>
                                                    <actb:AutoCompleteTextBox Grid.Row="1" CharacterCasing="Upper" Text="{Binding Source={StaticResource vm}, Path=TextReceta, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Top" IsEnabled="{Binding ElementosDisponibles}"
                                                  x:Name="AutoCompleteReceta" MaxCompletions="10000" Width="400" ItemsSource="{Binding Source={StaticResource receta}}" ItemTemplateSelector="{StaticResource TemplateSelector}" 
                                                  Binding="{Binding XPath=suggestion/@data}" HorizontalAlignment="Left"/>
                                                    <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding ListRecetas}" Height="150" SelectionUnit="FullRow" IsReadOnly="True"
                                  Grid.Row="2" Width="{Binding ActualWidth,ConverterParameter=x-1,Converter={Views:MathConverter},ElementName=lbAnchoTratamiento}" SelectedItem="{Binding SelectReceta}" IsEnabled="{Binding RecetaEnabled}"
                                  Name="dgRecetaMedicaTratamiento" Style="{StaticResource MetroDataGrid}">
                                                        <DataGrid.Columns>
                                                            <DataGridTextColumn Header="Descripción" Binding="{Binding PRODUCTO.NOMBRE}"></DataGridTextColumn>
                                                            <DataGridTemplateColumn Header="Cantidad">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBox Text="{Binding CANTIDAD,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True,TargetNullValue={x:Static sys:String.Empty}}">
                                                                            <i:Interaction.Behaviors>
                                                                                <Views:TextBoxInputBehavior InputMode="DecimalInput"/>
                                                                                <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9.]" MaxLength="3" />
                                                                            </i:Interaction.Behaviors>
                                                                        </TextBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTextColumn Binding="{Binding PRODUCTO.PRODUCTO_UNIDAD_MEDIDA.NOMBRE}" Header="Unidad de medida"></DataGridTextColumn>
                                                            <DataGridTemplateColumn Header="PRESENTACIÓN">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <ComboBox ItemsSource="{Binding PRODUCTO.PRODUCTO_PRESENTACION_MED}" DisplayMemberPath="PRESENTACION_MEDICAMENTO.DESCRIPCION" SelectedValuePath="ID_PRESENTACION_MEDICAMENTO" 
                                                      SelectedValue="{Binding PRESENTACION,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}"></ComboBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Duración (Días)">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBox Text="{Binding DURACION,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True,TargetNullValue={x:Static sys:String.Empty}}">
                                                                            <i:Interaction.Behaviors>
                                                                                <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]+$" MaxLength="3" />
                                                                            </i:Interaction.Behaviors>
                                                                        </TextBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Mañana">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <CheckBox IsChecked="{Binding HORA_MANANA,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}"></CheckBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Tarde">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <CheckBox IsChecked="{Binding HORA_TARDE,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}"></CheckBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Noche">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <CheckBox IsChecked="{Binding HORA_NOCHE,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}"></CheckBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Observaciones">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBox Text="{Binding OBSERVACIONES,UpdateSourceTrigger=PropertyChanged,TargetNullValue={x:Static sys:String.Empty}}" MinWidth="200" CharacterCasing="Upper"></TextBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                        </DataGrid.Columns>
                                                        <DataGrid.InputBindings>
                                                            <MouseBinding Gesture="LeftDoubleClick" Command="{Binding OnClick}" CommandParameter="{Binding ElementName=dgRecetaMedica}"></MouseBinding>
                                                        </DataGrid.InputBindings>
                                                        <DataGrid.ContextMenu>
                                                            <ContextMenu>
                                                                <MenuItem Header="Eliminar" Command="{Binding OnClick}" CommandParameter="eliminar_receta" />
                                                            </ContextMenu>
                                                        </DataGrid.ContextMenu>
                                                    </DataGrid>
                                                    <Label Content="Dietas" Grid.Row="3" HorizontalAlignment="Stretch" VerticalAlignment="Top"></Label>
                                                    <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding LstDietasTratamiento}" Height="150" SelectionUnit="FullRow" IsReadOnly="True"
                                                        Style="{StaticResource MetroDataGrid}" Grid.Row="4"  IsEnabled="{Binding ElementosDisponibles}">
                                                        <DataGrid.Columns>
                                                            <DataGridTextColumn Header="Descripción" Binding="{Binding DIETA.DESCR}"></DataGridTextColumn>
                                                            <DataGridTemplateColumn Header="Elige">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <CheckBox IsChecked="{Binding ELEGIDO,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" Name="CKB_DIETA" HorizontalAlignment="Center" 
                                                      IsEnabled="{Binding Path=DataContext.DietasEnabled,RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}">
                                                                            <i:Interaction.Triggers>
                                                                                <i:EventTrigger EventName="Unchecked">
                                                                                    <i:InvokeCommandAction Command="{Binding DataContext.Checked, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}">
                                                                                        <i:InvokeCommandAction.CommandParameter>
                                                                                            <MultiBinding Converter="{StaticResource MultiParamConverter}">
                                                                                                <Binding />
                                                                                                <Binding ElementName="CKB_DIETA" />
                                                                                                <Binding ElementName="CKB_DIETA" />
                                                                                            </MultiBinding>
                                                                                        </i:InvokeCommandAction.CommandParameter>
                                                                                    </i:InvokeCommandAction>
                                                                                </i:EventTrigger>
                                                                                <i:EventTrigger EventName="Checked">
                                                                                    <i:InvokeCommandAction Command="{Binding DataContext.Checked, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}">
                                                                                        <i:InvokeCommandAction.CommandParameter>
                                                                                            <MultiBinding Converter="{StaticResource MultiParamConverter}">
                                                                                                <Binding />
                                                                                                <Binding ElementName="CKB_DIETA" />
                                                                                                <Binding />
                                                                                            </MultiBinding>
                                                                                        </i:InvokeCommandAction.CommandParameter>
                                                                                    </i:InvokeCommandAction>
                                                                                </i:EventTrigger>
                                                                            </i:Interaction.Triggers>
                                                                        </CheckBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                        </DataGrid.Columns>
                                                    </DataGrid>
                                                </Grid>
                                            </GroupBox>
                                            <GroupBox Header="Procedimientos medicos" Grid.Row="5">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="250"></ColumnDefinition>
                                                        <ColumnDefinition></ColumnDefinition>
                                                        <ColumnDefinition></ColumnDefinition>
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition></RowDefinition>
                                                    </Grid.RowDefinitions>
                                                    <StackPanel>
                                                        <Label Content="Claisificación del procedimiento"></Label>
                                                        <ComboBox ItemsSource="{Binding LstProcMedSubTipo}" DisplayMemberPath="DESCR" SelectedValuePath="ID_PROCMED_SUBTIPO" SelectedValue="{Binding SelectedProcMedSubTipoValue, NotifyOnSourceUpdated=True}">
                                                            <i:Interaction.Triggers>
                                                                <i:EventTrigger EventName="SourceUpdated">
                                                                    <i:InvokeCommandAction Command="{Binding CmdModelChanged}" CommandParameter="cambio_proc_subtipo">
                                                                    </i:InvokeCommandAction>
                                                                </i:EventTrigger>
                                                            </i:Interaction.Triggers>
                                                        </ComboBox>
                                                        <Label Content="Procedimiento Médico"></Label>
                                                        <ComboBox ItemsSource="{Binding LstProcedimientoMedico}" DisplayMemberPath="DESCR" SelectedValuePath="ID_PROCMED" SelectedValue="{Binding SelectedProcedimientoMedicoValue}"></ComboBox>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="1" >
                                                        <Button HorizontalAlignment="Center" VerticalAlignment="Top" Width="100" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="10,20,10,0"
                                                            CommandParameter="agregar_procedimiento_medico" Command="{Binding OnClick}" IsEnabled="{Binding HabilitaImputados}">agregar -- ></Button>
                                                        <Button HorizontalAlignment="Center" VerticalAlignment="Top" Width="100" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="10,20,10,0"
                                                            CommandParameter="remove_procedimiento_medico" Command="{Binding OnClick}">&lt; -- quitar</Button>
                                                    </StackPanel>
                                                    <DataGrid Grid.Column="2" Height="200" Background="WhiteSmoke" AutoGenerateColumns="False"  CanUserAddRows="False" 
                                                        ItemsSource="{Binding ListProcMedsSeleccionados}" SelectedItem="{Binding SelectProcMedSeleccionado}" IsReadOnly="False" Style="{StaticResource MetroDataGrid}" >
                                                        <DataGrid.Columns>
                                                            <DataGridTextColumn Header="Descripción" Binding="{Binding PROC_MED_DESCR}" IsReadOnly="True"></DataGridTextColumn>
                                                            <DataGridTemplateColumn Header="Agenda" IsReadOnly="False">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Button Content="Agendar" HorizontalAlignment="Right" VerticalAlignment="Center" Width="93" Margin="5" Command="{Binding DataContext.OnClick,RelativeSource={RelativeSource AncestorType=DataGrid}}" 
                                                        CommandParameter="{Binding}" Style="{DynamicResource AccentedSquareButtonStyle}" Focusable="True" />
                                                                            <TextBlock Margin="10 0 0 0" Text="{Binding AGENDA}" TextWrapping="NoWrap"></TextBlock>
                                                                        </StackPanel>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                            <DataGridTemplateColumn Header="Observaciones" IsReadOnly="False">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBox Text="{Binding OBSERV,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper" MaxLength="500"></TextBox>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                        </DataGrid.Columns>
                                                        <DataGrid.InputBindings>
                                                            <MouseBinding Gesture="LeftDoubleClick" Command="{Binding OnClick}" CommandParameter="{Binding ElementName=dgProcedimientosMedicos}"></MouseBinding>
                                                        </DataGrid.InputBindings>
                                                    </DataGrid>
                                                </Grid>
                                            </GroupBox>
                                        </Grid>
                                    </GroupBox>
                                </Grid>
                            </GroupBox>
                        </Grid>
                    </GroupBox>
                    
                </Grid>
            </TabItem>
        </Controls:MetroAnimatedSingleRowTabControl>


    </Grid>
</UserControl>
