<UserControl x:Class="ControlPenales.NotaEvolucionView" 
             Name="NotaEvolucionWindow" 
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro" 
             xmlns:Views="clr-namespace:ControlPenales" 
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:actb="clr-namespace:ControlPenales.Controls"
             xmlns:cmd ="http://www.galasoft.ch/mvvmlight">
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding NotaMedicaLoaded}" CommandParameter="{Binding ElementName=NotaEvolucionWindow}" />
        </i:EventTrigger>
        <i:EventTrigger EventName="UnLoaded">
            <i:InvokeCommandAction Command="{Binding NotaMedicaUnLoaded}" CommandParameter="{Binding ElementName=NotaEvolucionWindow}" />
        </i:EventTrigger>
        <i:EventTrigger EventName="PreviewKeyDown">
            <cmd:EventToCommand Command="{Binding OnClick}" EventArgsConverter="{StaticResource EscapePopUpHelpper}" EventArgsConverterParameter="cerrar_buscar_huella_2"  PassEventArgsToCommand="True"  />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <UserControl.Resources>
        <Style TargetType="CheckBox">
            <Setter Property="BorderBrush" Value="Gray" />
            <Setter Property="BorderThickness" Value="2" />
        </Style>
        <Views:MultiValueConverter x:Key="MultiParamConverter"></Views:MultiValueConverter>
        <Views:TrimStringConverter x:Key="Trimming" />
        <Views:GetPersonaNombre x:Key="getPersonaNombre" />
        <Views:ConvertSignosVitales x:Key="convertSignosVitales" />
        <Views:ConvertConsultaMedica x:Key="convertConsultaMedica" />
        <Views:ConvertEstatusStringToBool x:Key="convertEstatusStringToBool" />
        <Views:BoolToOppositeBoolConverter x:Key="boolToOppositeBoolConverter" />
        <Views:AutocompleteViewModel x:Key="vm" />
        <Views:AutocompleteViewModel x:Key="autoProcedimientos" />
        <CollectionViewSource x:Key="xml">
            <CollectionViewSource.Source>
                <PriorityBinding>
                    <Binding Source="{StaticResource vm}" Path="QueryCollection" IsAsync="True"/>
                    <Binding Source="{StaticResource vm}" Path="WaitMessage"/>
                </PriorityBinding>
            </CollectionViewSource.Source>
        </CollectionViewSource>
        <CollectionViewSource x:Key="receta">
            <CollectionViewSource.Source>
                <PriorityBinding>
                    <Binding Source="{StaticResource vm}" Path="QueryReceta" IsAsync="True"/>
                    <Binding Source="{StaticResource vm}" Path="WaitMessage"/>
                </PriorityBinding>
            </CollectionViewSource.Source>
        </CollectionViewSource>
        <CollectionViewSource x:Key="collectionProcedimientos">
            <CollectionViewSource.Source>
                <PriorityBinding>
                    <Binding Source="{StaticResource autoProcedimientos}" Path="QueryProcedimiento" IsAsync="True"/>
                    <Binding Source="{StaticResource autoProcedimientos}" Path="WaitMessage"/>
                </PriorityBinding>
            </CollectionViewSource.Source>
        </CollectionViewSource>
        <Views:MyDataTemplateSelector x:Key="TemplateSelector"/>
        <DataTemplate x:Key="TheItemTemplate">
            <Border CornerRadius="5" BorderBrush="#427399" BorderThickness="3" Background="Transparent" HorizontalAlignment="Stretch" Grid.ColumnSpan="2" ScrollViewer.VerticalScrollBarVisibility="Visible">
                <Grid HorizontalAlignment="Left" Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100"></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal" Grid.Column="0" Margin="2" HorizontalAlignment="Left">
                        <TextBlock Text="CLAVE:  "/>
                        <TextBlock Text="{Binding CLAVE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="NOMBRE:  "/>
                        <TextBlock Text="{Binding NOMBRE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="TheItemTemplateReceta">
            <Border CornerRadius="5" BorderBrush="#427399" BorderThickness="3" Background="Transparent" HorizontalAlignment="Stretch" Grid.ColumnSpan="2" ScrollViewer.VerticalScrollBarVisibility="Visible">
                <Grid HorizontalAlignment="Left" Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal" Grid.Column="0" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="CATEGORIA:  "/>
                        <TextBlock Text="{Binding PRODUCTO.PRODUCTO_CATEGORIA.NOMBRE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="PRODUCTO:  "/>
                        <TextBlock Text="{Binding PRODUCTO.NOMBRE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="TheItemTemplateProcedimientos">
            <Border CornerRadius="5" BorderBrush="#427399" BorderThickness="3" Background="Transparent" HorizontalAlignment="Stretch" Grid.ColumnSpan="2" ScrollViewer.VerticalScrollBarVisibility="Visible">
                <Grid HorizontalAlignment="Left" Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"></ColumnDefinition>
                        <ColumnDefinition></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <StackPanel Orientation="Horizontal" Grid.Column="0" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="CATEGORIA:  "/>
                        <TextBlock Text="{Binding PRODUCTO.PRODUCTO_CATEGORIA.NOMBRE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Grid.Column="1" HorizontalAlignment="Left" Margin="2">
                        <TextBlock Text="PRODUCTO:  "/>
                        <TextBlock Text="{Binding PRODUCTO.NOMBRE, Converter={StaticResource Trimming}}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </DataTemplate>
        <DataTemplate x:Key="WaitTemplate">
            <TextBlock Text="{Binding}" Background="SlateBlue"/>
        </DataTemplate>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition></RowDefinition>
            <RowDefinition></RowDefinition>
        </Grid.RowDefinitions>
        <Label Name="lbGeneral" Visibility="Hidden"></Label>
        <Grid Name="gridIconos" ShowGridLines="false" VerticalAlignment="Top"  >
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition></ColumnDefinition>
                <ColumnDefinition Width="250"></ColumnDefinition>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition></RowDefinition>
            </Grid.RowDefinitions>

            <StackPanel Grid.Column="1" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">Guardar</Label>
                <Button Width="50" Height="50" ToolTip="Guardar" IsEnabled="{Binding MenuGuardarEnabled}" Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="guardar_menu"
                    Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}" >
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_save}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="2" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">
                    Buscar
                </Label>
                <Button Width="50" Height="50" ToolTip="Buscar" IsEnabled="{Binding MenuBuscarEnabled}"
                        Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="buscar_menu" Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_magnify_browse}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="3" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">Limpiar</Label>
                <Button  Width="50" Height="50" ToolTip="Limpiar" IsEnabled="{Binding MenuLimpiarEnabled}" Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="limpiar_menu" Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_clean}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="4" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">Reporte</Label>
                <Button  Width="50" Height="50" ToolTip="Reporte" IsEnabled="{Binding MenuReporteEnabled}"
                        Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="reporte_menu" Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_printer}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="5" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">Ficha</Label>
                <Button Width="50" Height="50" ToolTip="Ficha" IsEnabled="{Binding MenuFichaEnabled}"
                        Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="ficha_menu" Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_clipboard_file}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="6" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">H. Clinica</Label>
                <Button Width="50" Height="50" ToolTip="Historia Clinica" IsEnabled="{Binding MenuHClinicaEnabled}"
                        Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="historia_clinica_menu" Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_book_open_information}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="7" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">Archivos</Label>
                <Button Width="50" Height="50" ToolTip="Ayuda" IsEnabled="{Binding MenuArchivosEnabled}"
                        Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="menu_archivos_medicos" Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_cabinet_files}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="8" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">Ayuda</Label>
                <Button Width="50" Height="50" ToolTip="Ayuda" IsEnabled="{Binding MenuAyudaEnabled}"
                        Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="ayuda_menu" Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_question}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>

            <StackPanel Grid.Column="9" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">
                <Label HorizontalAlignment="Center" Padding="0">Salir</Label>
                <Button Width="50" Height="50" ToolTip="Salir" IsEnabled="{Binding MenuSalirEnabled}"
                        Style="{DynamicResource MetroCircleButtonStyle}" CommandParameter="salir_menu" Command="{Binding OnClick}">
                    <Rectangle Width="20" Height="20" Fill="{Binding Path=Foreground, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Button}}}">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Fill" Visual="{DynamicResource appbar_door_lock_closed}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Button>
            </StackPanel>
        </Grid>
        <StackPanel Grid.Row="1">
            <Grid Visibility="{Binding ListaImputadosVisible}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                </Grid.RowDefinitions>
                <Label Grid.Row="1" Content="Lista de Imputados" Style="{DynamicResource DescriptionHeaderStyle}" Name="lbAnchoListas" />
                <Label Grid.Row="1" Content="{Binding TextContador}" Style="{DynamicResource DescriptionHeaderStyle}" HorizontalAlignment="Right" />
                <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" SelectionUnit="FullRow" ItemsSource="{Binding ListHospitalizados}" Height="650" IsReadOnly="True" Margin="1" SelectedItem="{Binding SelectHospitalizado}"
                          Style="{StaticResource MetroDataGrid}" Grid.Row="3" Width="{Binding ActualWidth,ConverterParameter=x-10,Converter={Views:MathConverter},ElementName=lbGeneral}" Name="dgListaHospitalizados">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Año" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.ID_ANIO}"></DataGridTextColumn>
                        <DataGridTextColumn Header="Folio" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.ID_IMPUTADO}"></DataGridTextColumn>
                        <DataGridTextColumn Header="Paterno" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.IMPUTADO.PATERNO, Converter={StaticResource Trimming}}"></DataGridTextColumn>
                        <DataGridTextColumn Header="Materno" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.IMPUTADO.MATERNO, Converter={StaticResource Trimming}}"></DataGridTextColumn>
                        <DataGridTextColumn Header="Nombre" Binding="{Binding NOTA_MEDICA.ATENCION_MEDICA.INGRESO.IMPUTADO.NOMBRE, Converter={StaticResource Trimming}}"></DataGridTextColumn>
                        <DataGridTextColumn Header="Fecha Registro" Binding="{Binding INGRESO_FEC}"></DataGridTextColumn>
                        <DataGridTextColumn Header="Medico" Binding="{Binding USUARIO.EMPLEADO.PERSONA, Converter={StaticResource getPersonaNombre}}"></DataGridTextColumn>
                        <DataGridTextColumn Header="Estatus" Binding="{Binding HOSPITALIZACION_ESTATUS.DESCR}"></DataGridTextColumn>
                    </DataGrid.Columns>
                    <!--<DataGrid.InputBindings>
                        <MouseBinding Gesture="LeftDoubleClick" Command="{Binding OnClick}" CommandParameter="{Binding ElementName=dgListaHospitalizados}"></MouseBinding>
                    </DataGrid.InputBindings>-->
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Seleccionar" Command="{Binding OnClick}" CommandParameter="seleccionar_hospitalizacion" />
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                </DataGrid>
            </Grid>
            <Grid Visibility="{Binding NotaMedicaVisible}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                    <RowDefinition></RowDefinition>
                </Grid.RowDefinitions>
                <Label Grid.Row="0" Content="Nota de Evolución" Style="{DynamicResource DescriptionHeaderStyle}" />
                <Button Grid.Row="0" Style="{DynamicResource AccentedSquareButtonStyle}" Width="148" HorizontalAlignment="Right" VerticalAlignment="Center" CommandParameter="regresar_listado" 
                        Command="{Binding OnClick}" Visibility="{Binding BotonRegresarVisible}">Regresar al Listado</Button>
                <GroupBox Grid.Row="1" Header="Datos del Imputado" Margin="0 0 0 2">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"></ColumnDefinition>
                            <ColumnDefinition Width="auto"></ColumnDefinition>
                            <ColumnDefinition Width="2.5*"></ColumnDefinition>
                            <ColumnDefinition Width="2.5*"></ColumnDefinition>
                            <ColumnDefinition Width="5*"></ColumnDefinition>
                            <ColumnDefinition ></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>

                        <Label Grid.Column="0" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">Año</Label>
                        <Label Grid.Column="1" Grid.Row="1" Margin="-7.5,0,0,0">/</Label>
                        <Label Grid.Column="1" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Center">Folio</Label>
                        <Label Grid.Column="2" Grid.Row="0" VerticalAlignment="Center">Apellido Paterno</Label>
                        <Label Grid.Column="3" Grid.Row="0" VerticalAlignment="Center">Apellido Materno</Label>
                        <Label Grid.Column="4" Grid.Row="0" VerticalAlignment="Center">Nombre</Label>

                        <TextBox Grid.Column="0" Grid.Row="1" Text="{Binding TextAnioImputado,UpdateSourceTrigger=PropertyChanged,TargetNullValue=''}" Name="AnioBuscar"  CharacterCasing="Upper" MaxLength="4" 
                                 IsReadOnly="True" Margin="0 0 10 0" Width="50">
                            <i:Interaction.Behaviors>
                                <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]+$" MaxLength="4" />
                            </i:Interaction.Behaviors>
                        </TextBox>
                        <TextBox Grid.Column="1" Grid.Row="1" Text="{Binding TextFolioImputado,UpdateSourceTrigger=PropertyChanged,TargetNullValue=''}" Name="FolioBuscar" CharacterCasing="Upper" MaxLength="5" 
                                 IsReadOnly="True" Margin="10 0 0 0" Width="50">
                            <i:Interaction.Behaviors>
                                <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]+$" MaxLength="6" />
                            </i:Interaction.Behaviors>
                        </TextBox>
                        <TextBox Grid.Column="2" Grid.Row="1" Text="{Binding TextPaternoImputado,UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper" Name="ApellidoPaternoBuscar" MaxLength="30" 
                                 IsReadOnly="True">
                            <i:Interaction.Behaviors>
                                <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[a-zA-ZñÑ]*$" MaxLength="30" />
                            </i:Interaction.Behaviors>
                        </TextBox>
                        <TextBox Grid.Column="3" Grid.Row="1" Text="{Binding TextMaternoImputado, UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper"  Name="ApellidoMaternoBuscar" MaxLength="30" 
                                 IsReadOnly="True">
                            <i:Interaction.Behaviors>
                                <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[a-zA-ZñÑ]*$" MaxLength="30" />
                            </i:Interaction.Behaviors>
                        </TextBox>
                        <TextBox Grid.Column="4" Grid.Row="1" Text="{Binding TextNombreImputado, UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper"  Name="NombreBuscar" MaxLength="40" 
                                 IsReadOnly="True">
                            <i:Interaction.Behaviors>
                                <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[a-zA-ZñÑ]*$" MaxLength="40"  />
                            </i:Interaction.Behaviors>
                        </TextBox>
                        <Label Content="Sexo" Grid.Column="0" Grid.Row="2" VerticalAlignment="Center"></Label>
                        <Label Content="Edad" Grid.Column="2" Grid.Row="2" VerticalAlignment="Center"></Label>
                        <Label Grid.Column="3" Grid.Row="2" Content="Fecha" VerticalAlignment="Center"></Label>
                        <Label Grid.Column="4" Grid.Row="2" Content="Hora" VerticalAlignment="Center"></Label>
                        <TextBox MaxWidth="{Binding ElementName=lblAnchoColumna, Path=ActualWidth}" Grid.ColumnSpan="2" Grid.Column="0" Grid.Row="3" IsReadOnly="True" 
                                 Text="{Binding TextSexo, UpdateSourceTrigger=PropertyChanged}"></TextBox>
                        <TextBox MaxWidth="{Binding ElementName=lblAnchoColumna, Path=ActualWidth}" Grid.Column="2" Grid.Row="3" IsReadOnly="True" 
                                 Text="{ Binding TextEdad, UpdateSourceTrigger=PropertyChanged}"></TextBox>
                        <TextBox Grid.Column="3" Grid.Row="3" VerticalAlignment="Center" Text="{Binding TextFechaRegistro, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True"></TextBox>
                        <TextBox Grid.Column="4" Grid.Row="3" VerticalAlignment="Center" Text="{Binding TextHoraRegistro, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True"></TextBox>
                        <Image Grid.Column="5" Grid.Row="0" Grid.RowSpan="6" Height="125" Source="{Binding FotoIngreso}" VerticalAlignment="Stretch"  HorizontalAlignment="Stretch" ></Image>                        
                    </Grid>
                </GroupBox>
                <Expander Header="Signos Vitales" Grid.Row="2" Visibility="{Binding SignosVitalesVisible}" IsExpanded="{Binding SignosVitalesExpandidos}">
                    <AdornerDecorator>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition></ColumnDefinition>
                                <ColumnDefinition></ColumnDefinition>
                                <ColumnDefinition></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto"></RowDefinition>
                                <RowDefinition Height="auto"></RowDefinition>
                                <RowDefinition Height="auto"></RowDefinition>
                                <RowDefinition Height="auto"></RowDefinition>
                            </Grid.RowDefinitions>
                            <Label Content="Peso (KG)" Grid.Column="0" Grid.Row="0" Name="lblSig"></Label>
                            <Label Content="" Grid.Column="1" Grid.Row="0"></Label>
                            <!--IsEnabled="{Binding PesoEnabled}"-->
                            <TextBox Grid.Column="0" Grid.Row="1" MaxLength="5" Text="{Binding TextPeso,UpdateSourceTrigger=PropertyChanged,ValidatesOnDataErrors=True}" CharacterCasing="Upper"  
                                 IsReadOnly="{Binding SignosVitalesReadOnly}">
                                <i:Interaction.Behaviors>
                                    <Views:TextBoxInputBehavior InputMode="DecimalInput"/>
                                    <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9.]" MaxLength="5" />
                                </i:Interaction.Behaviors>
                            </TextBox>
                            <!--IsEnabled="{Binding TallaEnabled}"-->
                            <Grid Grid.Column="1" Grid.Row="0" Grid.RowSpan="2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition></ColumnDefinition>
                                    <ColumnDefinition></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition></RowDefinition>
                                    <RowDefinition></RowDefinition>
                                </Grid.RowDefinitions>
                                <Label Grid.Column="0" Grid.Row="0" Content="Talla (CM)"></Label>
                                <Label Grid.Column="1" Grid.Row="0" Content="Glucemia (MG/DL)"></Label>
                                <TextBox Grid.Column="0" Grid.Row="1" MaxLength="20" Text="{Binding TextTalla,UpdateSourceTrigger=PropertyChanged,ValidatesOnDataErrors=True}" CharacterCasing="Upper"  
                                 IsReadOnly="{Binding SignosVitalesReadOnly}">
                                    <i:Interaction.Behaviors>
                                        <Views:TextBoxInputBehavior InputMode="DecimalInput"/>
                                        <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9.]" MaxLength="20" />
                                    </i:Interaction.Behaviors>
                                </TextBox>
                                <TextBox Grid.Column="1" Grid.Row="1" MaxLength="20" Text="{Binding TextGlucemia,UpdateSourceTrigger=PropertyChanged,ValidatesOnDataErrors=True}" CharacterCasing="Upper"  
                                 IsReadOnly="{Binding SignosVitalesReadOnly}">
                                    <i:Interaction.Behaviors>
                                        <Views:TextBoxInputBehavior InputMode="DecimalInput"/>
                                        <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9.]" MaxLength="20" />
                                    </i:Interaction.Behaviors>
                                </TextBox>
                            </Grid>
                            <Grid Grid.Column="2" Grid.RowSpan="3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition></ColumnDefinition>
                                    <ColumnDefinition Width="120"></ColumnDefinition>
                                    <ColumnDefinition Width="80"></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition></RowDefinition>
                                    <RowDefinition></RowDefinition>
                                    <RowDefinition></RowDefinition>
                                </Grid.RowDefinitions>
                                <Label Content="Tensión Arterial" Grid.Column="0" Grid.Row="0"></Label>
                                <StackPanel Grid.Column="0" Grid.Row="1" Orientation="Horizontal">
                                    <TextBox MaxLength="5" Text="{Binding TextTensionArterial1,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" CharacterCasing="Upper" Width="75" IsReadOnly="{Binding SignosVitalesReadOnly}">
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="5" />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                    <Label Content="  /  " VerticalAlignment="Center"></Label>
                                    <TextBox MaxLength="5" Text="{Binding TextTensionArterial2,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" CharacterCasing="Upper" Width="75" IsReadOnly="{Binding SignosVitalesReadOnly}">
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="5" />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                </StackPanel>
                                <Label Grid.Column="1" Grid.ColumnSpan="2" HorizontalAlignment="Right" Margin="0 0 10 0">Última Captura de Signos Vitales</Label>
                                <Label Grid.Column="1" Grid.Row="1" HorizontalAlignment="Right">Fecha:</Label>
                                <Label Grid.Row="1" Grid.Column="2" Content="{Binding TextUltimaFechaSignos}"></Label>
                                <Label Grid.Row="2" Grid.Column="1" HorizontalAlignment="Right">Hora:</Label>
                                <Label Grid.Row="2" Grid.Column="2" Content="{Binding TextUltimaHoraSignos}"></Label>
                            </Grid>
                            <Label Content="Frecuencia Cardiaca (PPM)" Grid.Column="0" Grid.Row="2"></Label>
                            <Label Content="Frecuencia Respiratoria (RPM)" Grid.Column="1" Grid.Row="2"></Label>
                            <Label Content="Temperatura (°C)" Grid.Column="2" Grid.Row="2"></Label>
                            <TextBox Grid.Row="3" MaxLength="20" Text="{Binding TextFrecuenciaCardiaca,UpdateSourceTrigger=PropertyChanged,ValidatesOnDataErrors=True}" CharacterCasing="Upper" IsReadOnly="{Binding SignosVitalesReadOnly}">
                                <i:Interaction.Behaviors>
                                    <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="20" />
                                </i:Interaction.Behaviors>
                            </TextBox>
                            <TextBox Grid.Column="1" Grid.Row="3" MaxLength="20" Text="{Binding TextFrecuenciaRespira,UpdateSourceTrigger=PropertyChanged,ValidatesOnDataErrors=True}" CharacterCasing="Upper" IsReadOnly="{Binding SignosVitalesReadOnly}">
                                <i:Interaction.Behaviors>
                                    <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="20" />
                                </i:Interaction.Behaviors>
                            </TextBox>
                            <TextBox Grid.Column="2" Grid.Row="3" MaxLength="20" Text="{Binding TextTemperatura,UpdateSourceTrigger=PropertyChanged,ValidatesOnDataErrors=True}" CharacterCasing="Upper" IsReadOnly="{Binding SignosVitalesReadOnly}">
                                <i:Interaction.Behaviors>
                                    <Views:TextBoxInputBehavior InputMode="DecimalInput"/>
                                    <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9.]" MaxLength="20" />
                                </i:Interaction.Behaviors>
                            </TextBox>
                        </Grid>
                    </AdornerDecorator>
                </Expander>
                <Expander Grid.Row="3" Header="Exploracion Fisica" Visibility="{Binding ExploracionFisicaVisible}">
                    <AdornerDecorator>
                        <StackPanel>
                            <Label Grid.Column="0" Grid.Row="2" Content="Exploración Física" Name="lblMaestro"></Label>
                            <TextBlock Grid.Column="0" Grid.Row="2" TextWrapping="Wrap" Text="{Binding LabelExploracionFisica}"></TextBlock>
                            <TextBox Grid.Column="0" Grid.Row="3" MaxLength="{Binding LengthExploracionFisica}" CharacterCasing="Upper" TextWrapping="Wrap" Height="75" ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 Text="{Binding TextExploracionFisica, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Name="ExploracionFisicaTB" HorizontalAlignment="Left"
                                 Width="{Binding ActualWidth,ConverterParameter=x-150,Converter={Views:MathConverter},ElementName=lblMaestro}"></TextBox>
                        </StackPanel>
                    </AdornerDecorator>
                </Expander>
                <Expander Grid.Row="4" Header="Resumen Interrogatorio" Visibility="{Binding ResumenInterrogatorioVisible}">
                    <AdornerDecorator>
                        <StackPanel>
                            <Label Grid.Column="0" Grid.Row="2" Content="Resumen Interrogatorio" Name="lblResumen"></Label>
                            <TextBlock Grid.Column="0" Grid.Row="2" TextWrapping="Wrap" Text="{Binding LabelResumenInterrogatorio}"></TextBlock>
                            <TextBox Grid.Column="0" Grid.Row="3" MaxLength="{Binding LengthResumenInterrogatorio}" CharacterCasing="Upper" TextWrapping="Wrap" Height="75" ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 Text="{Binding TextResumenInterrogatorio, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Name="ResumenInterrogatorioTB" HorizontalAlignment="Left"
                                 Width="{Binding ActualWidth,ConverterParameter=x-150,Converter={Views:MathConverter},ElementName=lblResumen}"></TextBox>
                        </StackPanel>
                    </AdornerDecorator>
                </Expander>
                <Expander Grid.Row="5" Header="Estudios Realizados y Resultados" Visibility="{Binding EstudiosVisible}">
                    <AdornerDecorator>
                        <StackPanel>
                            <Label Grid.Column="0" Grid.Row="2" Content="Estudios Realizados y Resultados" Name="lblEstudios"></Label>
                            <TextBlock Grid.Column="0" Grid.Row="2" Text="{Binding LabelEstudios}" TextWrapping="Wrap"></TextBlock>
                            <TextBox Grid.Column="0" Grid.Row="3" MaxLength="{Binding LengthEstudios}" CharacterCasing="Upper" TextWrapping="Wrap" Height="75" ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 Text="{Binding TextEstudios, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Name="EstudiosTB" HorizontalAlignment="Left"
                                 Width="{Binding ActualWidth,ConverterParameter=x-150,Converter={Views:MathConverter},ElementName=lblEstudios}"></TextBox>
                        </StackPanel>
                    </AdornerDecorator>
                </Expander>
                <Expander Header="Diagnostico" Grid.Column="0" Grid.Row="6" Visibility="{Binding DiagnosticoVisible}">
                    <AdornerDecorator>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition></ColumnDefinition>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition></RowDefinition>
                                <RowDefinition></RowDefinition>
                                <RowDefinition></RowDefinition>
                            </Grid.RowDefinitions>
                            <Label Name="lbAnchoEnfermedad" Content=""></Label>
                            <StackPanel Grid.Column="0" Grid.Row="0" Margin="1 0 3 0">
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Diagnóstico"></Label>
                                    <actb:AutoCompleteTextBox CharacterCasing="Upper" Text="{Binding Source={StaticResource vm}, Path=QueryText, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Top"
                                                  x:Name="AutoCompleteTB" MaxCompletions="10" Width="350" ItemsSource="{Binding Source={StaticResource xml}}" ItemTemplateSelector="{StaticResource TemplateSelector}" 
                                                  Binding="{Binding XPath=suggestion/@data}"/>
                                </StackPanel>
                                <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding ListEnfermedades}" SelectedItem="{Binding SelectEnfermedad}" Height="150" SelectionUnit="FullRow"
                                          Style="{StaticResource MetroDataGrid}" Grid.Column="1" Margin="0 3 0 0" Width="{Binding ActualWidth,ConverterParameter=x-1,Converter={Views:MathConverter},ElementName=lbAnchoDiagnostico1}">
                                    <DataGrid.Columns>
                                        <DataGridTemplateColumn>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding ENFERMEDAD.CLAVE}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsEnabled" Value="False">
                                                                        <Setter Property="Foreground" Value="Black"></Setter>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                            <DataGridTemplateColumn.HeaderTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="Clave">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="FontSize" Value="13px"></Setter>
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsEnabled" Value="False">
                                                                        <Setter Property="Foreground" Value="White"></Setter>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.HeaderTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTemplateColumn>
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding ENFERMEDAD.NOMBRE}">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsEnabled" Value="False">
                                                                        <Setter Property="Foreground" Value="Black"></Setter>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                            <DataGridTemplateColumn.HeaderTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="Nombre">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="FontSize" Value="13px"></Setter>
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsEnabled" Value="False">
                                                                        <Setter Property="Foreground" Value="White"></Setter>
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.HeaderTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                    <!--<DataGrid.ContextMenu>
                                        <ContextMenu >
                                            <MenuItem Header="Borrar..." CommandParameter="borrar_enfermedad" Command="{Binding OnClick}" IsEnabled="{Binding BorrarEnfermedadEnabled}" />
                                        </ContextMenu>
                                    </DataGrid.ContextMenu>-->
                                </DataGrid>
                                <Label Grid.Column="0" Grid.Row="0" Content="Pronóstico"></Label>
                                <ComboBox ItemsSource="{Binding ListPronostico}" SelectedValue="{Binding SelectPronostico,ValidatesOnDataErrors=True}" SelectedValuePath="ID_PRONOSTICO" DisplayMemberPath="DESCR" Width="300" 
                                          HorizontalAlignment="Left"></ComboBox>
                                <StackPanel Orientation="Horizontal" Visibility="Visible">
                                    <StackPanel Orientation="Horizontal">
                                        <Label Content="Solicita Interconsulta" Margin="0 0 -5 0"></Label>
                                        <CheckBox IsChecked="{Binding SolicitaInterconsultaCheck}" Margin="10 0 0 0" HorizontalAlignment="Center" VerticalAlignment="Center" IsEnabled="{Binding InterconsultaEnabled}"></CheckBox>
                                    </StackPanel>
                                    <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Left" Visibility="Collapsed">
                                        <Label Content="Amerita hospitalización?" Margin="20 0 -5 0"></Label>
                                        <CheckBox Margin="10 5 0 0" IsChecked="{Binding CheckedHospitalizacion}" ></CheckBox>
                                    </StackPanel>
                                    <StackPanel Visibility="Collapsed" Orientation="Horizontal">
                                        <!--<StackPanel Visibility="{Binding CertificadoMedicoIngresoVisible}" Orientation="Horizontal">-->
                                        <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Left">
                                            <Label Content="Pone en peligro la vida?" Margin="20 0 -5 0"></Label>
                                            <CheckBox Margin="10 5 0 0" IsChecked="{Binding CheckedPeligroVida}" ></CheckBox>
                                        </StackPanel>
                                        <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 0 10 0">
                                            <Label Content="Tarda 15 días en sanar?" Margin="20 0 -5 0"></Label>
                                            <CheckBox Margin="10 5 0 0" IsChecked="{Binding Checked15DiasSanar}" ></CheckBox>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Visibility="Collapsed">
                                    <Label Content="Requiere estudios?"></Label>
                                    <CheckBox IsChecked="{Binding RequiereEstudiosCheck}" VerticalAlignment="Center" Margin="10 3 0 0"></CheckBox>
                                </StackPanel>
                            </StackPanel>
                            <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Bottom" Margin="0 5 0 5" Visibility="Collapsed">
                                <Label Content="Requiere de un seguimiento médico?"></Label>
                                <CheckBox Margin="10 0 0 3" IsChecked="{Binding CheckedSeguimiento}" VerticalAlignment="Center" Content="Si / No"></CheckBox>
                                <Button HorizontalAlignment="Left" VerticalAlignment="Top" Width="150" Style="{DynamicResource AccentedSquareButtonStyle}" CommandParameter="agendar_cita" 
                                     Command="{Binding OnClick}" Margin="10 3 0 0" IsEnabled="{Binding SeguimientoEnabled}">Agendar Cita</Button>
                                <Label Content="{Binding StrFechaSeguimiento}" Margin="20 3 0 0"></Label>
                            </StackPanel>
                            <Expander Header="Historia clinica" Grid.Row="1" IsEnabled="{Binding HistoriaClinicaEnabled}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                    </Grid.RowDefinitions>
                                    <StackPanel Grid.Row="0" Visibility="{Binding CertificadoMedicoIngresoVisible}">
                                        <Label Grid.Column="0" Grid.Row="0" Content="Padecimiento Actual" Name="lblMaestro2"></Label>
                                        <TextBox Grid.Column="0" Grid.Row="1" MaxLength="500" IsEnabled="{Binding ElementosDisponibles}" CharacterCasing="Upper" TextWrapping="Wrap" ScrollViewer.VerticalScrollBarVisibility="Auto"
                                             Text="{Binding ResumenInterr, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Height="75" Name="ResumenInterrogatorioTB2" HorizontalAlignment="Left"
                                             Width="{Binding ActualWidth,ConverterParameter=x-150,Converter={Views:MathConverter},ElementName=lblMaestro2}"></TextBox>
                                        <StackPanel Orientation="Horizontal">
                                            <Label Grid.Row="2" Grid.Column="0" Content="Toxicomanias"></Label>
                                            <CheckBox Grid.Row="2" Content="Si / No" Margin="10 5 0 0" IsChecked="{Binding CheckedToxicomanias}"></CheckBox>
                                        </StackPanel>
                                        <TextBox Grid.Row="3" Height="75" AcceptsReturn="True" Width="{Binding ActualWidth, ConverterParameter=x-1, Converter={Views:MathConverter}, ElementName=lbAnchoDiagnostico}"
                                             Text="{Binding TextToxicomanias,UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding CheckedToxicomanias}" CharacterCasing="Upper" TextWrapping="Wrap"></TextBox>
                                        <Label Grid.Column="0" Grid.Row="4" Content="Tratamiento"></Label>
                                        <ComboBox IsEnabled="{Binding ElementosDisponibles}" Grid.Row="5" ItemsSource="{Binding LstPronostico}" SelectedValue="{Binding SelectedPronostico,ValidatesOnDataErrors=True}"
                                                  SelectedValuePath="ID_PRONOSTICO" DisplayMemberPath="DESCR"></ComboBox>
                                    </StackPanel>
                                    <GroupBox Grid.Row="1" Grid.Column="0" Header="Antecedentes patologicos personales">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="300"></ColumnDefinition>
                                                <ColumnDefinition Width="150"></ColumnDefinition>
                                                <ColumnDefinition Width="*"></ColumnDefinition>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="auto"></RowDefinition>
                                                <RowDefinition Height="auto"></RowDefinition>
                                                <RowDefinition Height="auto"></RowDefinition>
                                                <RowDefinition Height="auto"></RowDefinition>
                                                <RowDefinition Height="auto"></RowDefinition>
                                            </Grid.RowDefinitions>
                                            <DataGrid Grid.Row="0" Grid.Column="0" Grid.RowSpan="5" Height="200" Background="WhiteSmoke" AutoGenerateColumns="False"  CanUserAddRows="False" IsReadOnly="True" ItemsSource="{Binding LstPatologicos}" 
                                                  SelectedItem="{Binding SelectedPatologico,UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource MetroDataGrid}" SelectionMode="Single">
                                                <i:Interaction.Triggers>
                                                    <Views:RoutedEventTrigger RoutedEvent="ScrollViewer.ScrollChanged" >
                                                        <cmd:EventToCommand Command="{Binding CargarMasResultados}" PassEventArgsToCommand="True" />
                                                    </Views:RoutedEventTrigger>
                                                </i:Interaction.Triggers>
                                                <DataGrid.Columns>
                                                    <DataGridTextColumn Header="Descripción" Binding="{Binding PATOLOGICO_CAT.DESCR }" ></DataGridTextColumn>
                                                </DataGrid.Columns>
                                                <DataGrid.RowStyle>
                                                    <Style TargetType="DataGridRow" BasedOn="{StaticResource MetroDataGridRow}">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding SELECCIONADO,UpdateSourceTrigger=PropertyChanged}" Value="true">
                                                                <Setter Property="Background" Value="SkyBlue"></Setter>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </DataGrid.RowStyle>
                                            </DataGrid>
                                            <Label Name="lbPatos" Grid.Column="2"></Label>
                                            <DataGrid Grid.Row="0" Grid.Column="2" Grid.RowSpan="5" Height="200" Background="WhiteSmoke" AutoGenerateColumns="False" Name="dgHistorialClinico" CanUserAddRows="False" 
                                                      ItemsSource="{Binding LstCondensadoPatologicos}" SelectedItem="{Binding SelectedCondensadoPato}" IsReadOnly="False" Style="{StaticResource MetroDataGrid}" >
                                                <DataGrid.Columns>
                                                    <DataGridTextColumn Header="Fecha Registro" Binding="{Binding REGISTRO_FEC,StringFormat={}{0:dd/MM/yyyy}}" IsReadOnly="True"></DataGridTextColumn>
                                                    <DataGridTextColumn Header="Descripción" Binding="{Binding PATOLOGICO_CAT.DESCR}" IsReadOnly="True"></DataGridTextColumn>
                                                    <DataGridTemplateColumn Header="Recuperado">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <CheckBox IsChecked="{Binding RECUPERADO,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding DESHABILITADO}"></CheckBox>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTemplateColumn Header="Observaciones" IsReadOnly="False">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <TextBox Text="{Binding OBSERVACIONES,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper" MaxLength="1000"
                                                                         IsEnabled="{Binding DESHABILITADO}"></TextBox>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                </DataGrid.Columns>
                                                <DataGrid.InputBindings>
                                                    <MouseBinding Gesture="LeftDoubleClick" Command="{Binding OnClick}" CommandParameter="{Binding ElementName=dgHistorialClinico}"></MouseBinding>
                                                </DataGrid.InputBindings>
                                            </DataGrid>
                                            <Button Grid.Column="1" Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Top" Width="100" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="10,0,10,0"
                                                CommandParameter="agregar_patol" Command="{Binding OnClick}" IsEnabled="{Binding HabilitaImputados}">agregar -- ></Button>
                                            <Button Grid.Column="1" Grid.Row="3" HorizontalAlignment="Center" VerticalAlignment="Top" Width="100" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="10,0,10,0"
                                                CommandParameter="remove_patol" Command="{Binding OnClick}">&lt; -- quitar</Button>
                                        </Grid>
                                    </GroupBox>
                                </Grid>
                            </Expander>
                            <Expander Header="Mujeres" Grid.Row="2" Visibility="{Binding MujeresVisible}">
                                <Grid IsEnabled="{Binding MujeresEnabled}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                        <ColumnDefinition></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                        <RowDefinition Height="auto"></RowDefinition>
                                    </Grid.RowDefinitions>
                                    <Label Grid.Column="0" Grid.Row="0" Content="Menarquía" Name="lblReferencia"></Label>
                                    <Label Grid.Column="1" Grid.Row="0" Content="Años Ritmo"></Label>
                                    <Label Grid.Column="2" Grid.Row="0" Content="Embarazos"></Label>
                                    <TextBox Grid.Column="0" Grid.Row="1" Text="{Binding CheckMenarquia,TargetNullValue={x:Static sys:String.Empty}, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" 
                                             MaxWidth="{ Binding ElementName=lblReferencia, Path=ActualWidth}" IsEnabled="False" >
                                        <!--IsEnabled="{Binding MenarquiaEnabled}"-->
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="3" />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                    <TextBox Grid.Column="1" Grid.Row="1" Text="{Binding TextAniosRitmo, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" MaxWidth="{ Binding ElementName=lblReferencia, Path=ActualWidth}" MaxLength="100" CharacterCasing="Upper"></TextBox>
                                    <TextBox Grid.Column="2" Grid.Row="1" Text="{Binding TextEmbarazos,TargetNullValue={x:Static sys:String.Empty},UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" MaxWidth="{ Binding ElementName=lblReferencia, Path=ActualWidth}">
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="3" />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                    <Label Grid.Column="0" Grid.Row="2" Content="Partos"></Label>
                                    <Label Grid.Column="1" Grid.Row="2" Content="Abortos"></Label>
                                    <Label Grid.Column="2" Grid.Row="2" Content="Cesáreas"></Label>
                                    <TextBox Grid.Column="0" Grid.Row="3" Text="{Binding TextPartos,TargetNullValue={x:Static sys:String.Empty},UpdateSourceTrigger=PropertyChanged}" MaxWidth="{ Binding ElementName=lblReferencia, Path=ActualWidth}">
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="3" />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                    <TextBox Grid.Column="1" Grid.Row="3" Text="{Binding TextAbortos,TargetNullValue={x:Static sys:String.Empty},UpdateSourceTrigger=PropertyChanged}" MaxWidth="{ Binding ElementName=lblReferencia, Path=ActualWidth}">
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="3" />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                    <TextBox Grid.Column="2" Grid.Row="3" Text="{Binding TextCesareas,TargetNullValue={x:Static sys:String.Empty},UpdateSourceTrigger=PropertyChanged}" MaxWidth="{ Binding ElementName=lblReferencia, Path=ActualWidth}">
                                        <i:Interaction.Behaviors>
                                            <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]" MaxLength="3" />
                                        </i:Interaction.Behaviors>
                                    </TextBox>
                                    <Label Grid.Column="0" Grid.Row="4" Content="Fecha de la ultima menstruación"></Label>
                                    <Label Grid.Column="1" Grid.Row="4" Content="Deformaciones Orgánicas"></Label>
                                    <Label Grid.Column="2" Grid.Row="4" Content="Fecha Probable de Parto"></Label>
                                    <DatePicker Grid.Column="0" Grid.Row="5" SelectedDate="{Binding FechaUltimaMenstruacion,TargetNullValue={x:Static sys:String.Empty},UpdateSourceTrigger=PropertyChanged}" Controls:TextBoxHelper.Watermark="Selecciona una fecha"></DatePicker>
                                    <TextBox Grid.Column="1" Grid.Row="5" Text="{Binding TextDeformacionesOrganicas,UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper" MaxLength="100" MaxWidth="{ Binding ElementName=lblReferencia, Path=ActualWidth}"></TextBox>
                                    <DatePicker Grid.Column="2" Grid.Row="5" SelectedDate="{Binding FechaProbParto,TargetNullValue={x:Static sys:String.Empty},UpdateSourceTrigger=PropertyChanged}" Controls:TextBoxHelper.Watermark="Selecciona una fecha"></DatePicker>
                                    <Label Grid.Column="0" Grid.Row="6" Content="Lleva control prenatal"></Label>
                                    <ComboBox Grid.Column="0" Grid.Row="7" SelectedValuePath="Tag" SelectedValue="{Binding ControlPreNatal, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}">
                                        <ComboBoxItem Content="SELECCIONE" Tag="-1"></ComboBoxItem>
                                        <ComboBoxItem Content="SI" Tag="0"></ComboBoxItem>
                                        <ComboBoxItem Content="NO" Tag="1"></ComboBoxItem>
                                    </ComboBox>
                                    <Label Grid.Column="1" Grid.Row="6" Content="Cual?" Grid.ColumnSpan="2" Name="lblBigReference"></Label>
                                    <ComboBox Grid.Column="1" Grid.Row="7" Grid.ColumnSpan="2" IsEnabled="{Binding IsEnabledControlP, UpdateSourceTrigger=PropertyChanged}" 
                                          SelectedValue="{ Binding SelectControlPreNatal, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, Mode=TwoWay}" 
                                          ItemsSource="{ Binding ListControlPrenatal}" SelectedValuePath="ID_CONTROL_PRENATAL" DisplayMemberPath="DESCR"></ComboBox>
                                </Grid>
                            </Expander>
                        </Grid>
                    </AdornerDecorator>
                </Expander>
                <Expander Header="Plan y Seguimiento" Grid.Column="0" Grid.Row="7" Visibility="{Binding PlanSeguimientoVisible}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition Height="auto"></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>
                        <Label Content="Medicamento" HorizontalAlignment="Stretch" Name="lbAnchoTratamiento" VerticalAlignment="Top" Grid.ColumnSpan="2" ></Label>
                        <actb:AutoCompleteTextBox Grid.Row="1" CharacterCasing="Upper" Text="{Binding Source={StaticResource vm}, Path=TextReceta, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Top"
                                                  x:Name="AutoCompleteReceta" MaxCompletions="10000" Width="400" ItemsSource="{Binding Source={StaticResource receta}}" ItemTemplateSelector="{StaticResource TemplateSelector}" 
                                                  Binding="{Binding XPath=suggestion/@data}" HorizontalAlignment="Left"/>
                        <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding ListRecetas}" Height="150" SelectionUnit="FullRow" IsReadOnly="True" HorizontalAlignment="Left"
                                  Grid.Row="2" SelectedItem="{Binding SelectReceta}" Name="dgRecetaMedica" Style="{StaticResource MetroDataGrid}" Grid.ColumnSpan="2"
                                  Width="{Binding ActualWidth,ConverterParameter=x,Converter={Views:MathConverter},ElementName=lbAnchoTratamiento}" >
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Descripción" Binding="{Binding PRODUCTO.NOMBRE}"></DataGridTextColumn>
                                <DataGridTemplateColumn Header="Cantidad">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBox Text="{Binding CANTIDAD,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True,TargetNullValue={x:Static sys:String.Empty}}" IsEnabled="{Binding HABILITAR}">
                                                <i:Interaction.Behaviors>
                                                    <Views:TextBoxInputBehavior InputMode="DecimalInput"/>
                                                    <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9.]" MaxLength="3" />
                                                </i:Interaction.Behaviors>
                                            </TextBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Binding="{Binding PRODUCTO.PRODUCTO_UNIDAD_MEDIDA.NOMBRE}" Header="Unidad de medida" ></DataGridTextColumn>
                                <DataGridTemplateColumn Header="PRESENTACIÓN">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <ComboBox ItemsSource="{Binding PRODUCTO.PRODUCTO_PRESENTACION_MED}" DisplayMemberPath="PRESENTACION_MEDICAMENTO.DESCRIPCION" SelectedValuePath="ID_PRESENTACION_MEDICAMENTO" 
                                                      SelectedValue="{Binding PRESENTACION,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding HABILITAR}"></ComboBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Duración (Días)">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBox Text="{Binding DURACION,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True,TargetNullValue={x:Static sys:String.Empty}}" IsEnabled="{Binding HABILITAR}">
                                                <i:Interaction.Behaviors>
                                                    <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]+$" MaxLength="3" />
                                                </i:Interaction.Behaviors>
                                            </TextBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Mañana">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding HORA_MANANA,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding HABILITAR}"></CheckBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Tarde">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding HORA_TARDE,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding HABILITAR}"></CheckBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Noche">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding HORA_NOCHE,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding HABILITAR}"></CheckBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Observaciones">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Grid MaxWidth="402">
                                                <TextBox Text="{Binding OBSERVACIONES,UpdateSourceTrigger=PropertyChanged,TargetNullValue={x:Static sys:String.Empty}}" CharacterCasing="Upper" IsEnabled="{Binding HABILITAR}"
                                                     TextWrapping="Wrap" AcceptsReturn="False" MaxLength="2000" MaxWidth="400" Height="Auto" ScrollViewer.CanContentScroll="True" MaxHeight="100"></TextBox>
                                            </Grid>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                            <DataGrid.InputBindings>
                                <MouseBinding Gesture="LeftDoubleClick" Command="{Binding OnClick}" CommandParameter="{Binding ElementName=dgRecetaMedica}"></MouseBinding>
                            </DataGrid.InputBindings>
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Eliminar" Command="{Binding OnClick}" CommandParameter="eliminar_receta" />
                                </ContextMenu>
                            </DataGrid.ContextMenu>
                        </DataGrid>
                        <!--<Label Content="Historial de Dietas" Grid.Row="3" Grid.Column="1" HorizontalAlignment="Stretch" VerticalAlignment="Top"></Label>-->
                        <GroupBox Grid.Row="3" Header="Historial de Medicamento">
                            <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding ListHistorialRecetas}" Height="150" SelectionUnit="FullRow" IsReadOnly="True"
                              Style="{StaticResource MetroDataGrid}" SelectedItem="{Binding SelectRecetaHistorial}">
                                <DataGrid.Columns>
                                    <DataGridTemplateColumn Header="Suspendido">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox HorizontalAlignment="Center" IsChecked="{Binding ELIMINADO}" IsEnabled="{Binding HABILITAR}"></CheckBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="Descripción" Binding="{Binding PRODUCTO.NOMBRE}"></DataGridTextColumn>
                                    <DataGridTemplateColumn Header="Cantidad">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBox Text="{Binding CANTIDAD,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True,TargetNullValue={x:Static sys:String.Empty}}" IsEnabled="{Binding HABILITAR}">
                                                    <i:Interaction.Behaviors>
                                                        <Views:TextBoxInputBehavior InputMode="DecimalInput"/>
                                                        <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9.]" MaxLength="3" />
                                                    </i:Interaction.Behaviors>
                                                </TextBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Binding="{Binding PRODUCTO.PRODUCTO_UNIDAD_MEDIDA.NOMBRE}" Header="Unidad de medida" ></DataGridTextColumn>
                                    <DataGridTemplateColumn Header="PRESENTACIÓN">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <ComboBox ItemsSource="{Binding PRODUCTO.PRODUCTO_PRESENTACION_MED}" DisplayMemberPath="PRESENTACION_MEDICAMENTO.DESCRIPCION" SelectedValuePath="ID_PRESENTACION_MEDICAMENTO" 
                                                      SelectedValue="{Binding PRESENTACION,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding HABILITAR}"></ComboBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="Duración (Días)">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBox Text="{Binding DURACION,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True,TargetNullValue={x:Static sys:String.Empty}}" IsEnabled="{Binding HABILITAR}">
                                                    <i:Interaction.Behaviors>
                                                        <Views:AllowableCharactersTextBoxBehavior RegularExpression="^[0-9]+$" MaxLength="3" />
                                                    </i:Interaction.Behaviors>
                                                </TextBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="Mañana">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding HORA_MANANA,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding HABILITAR}"></CheckBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="Tarde">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding HORA_TARDE,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding HABILITAR}"></CheckBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="Noche">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding HORA_NOCHE,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" IsEnabled="{Binding HABILITAR}"></CheckBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="Observaciones">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBox Text="{Binding OBSERVACIONES,UpdateSourceTrigger=PropertyChanged,TargetNullValue={x:Static sys:String.Empty}}" MaxWidth="350" TextWrapping="Wrap" CharacterCasing="Upper" 
                                                         AcceptsReturn="True" IsEnabled="{Binding HABILITAR}"></TextBox>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                                <DataGrid.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Suspender/Cancelar" Command="{Binding OnClick}" CommandParameter="eliminar_receta_historial" />
                                    </ContextMenu>
                                </DataGrid.ContextMenu>
                            </DataGrid>
                        </GroupBox>
                        <Label Content="Dietas" Grid.Row="4" HorizontalAlignment="Stretch" VerticalAlignment="Top"></Label>
                        <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding ListDietas}" Height="150" SelectionUnit="FullRow" IsReadOnly="True" HorizontalAlignment="Left"
                              Style="{StaticResource MetroDataGrid}" Grid.Row="5" Width="{Binding ActualWidth,ConverterParameter=x-1,Converter={Views:MathConverter},ElementName=lbAnchoTratamiento}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Descripción" Binding="{Binding DIETA.DESCR}"></DataGridTextColumn>
                                <DataGridTemplateColumn Header="Elige">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding ELEGIDO,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnSourceUpdated=True}" Name="CKB_DIETA" HorizontalAlignment="Center" 
                                                      IsEnabled="{Binding Path=DataContext.DietasEnabled,RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}">
                                                <i:Interaction.Triggers>
                                                    <i:EventTrigger EventName="Unchecked">
                                                        <i:InvokeCommandAction Command="{Binding DataContext.Checked, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}">
                                                            <i:InvokeCommandAction.CommandParameter>
                                                                <MultiBinding Converter="{StaticResource MultiParamConverter}">
                                                                    <Binding />
                                                                    <Binding ElementName="CKB_DIETA" />
                                                                    <Binding ElementName="CKB_DIETA" />
                                                                </MultiBinding>
                                                            </i:InvokeCommandAction.CommandParameter>
                                                        </i:InvokeCommandAction>
                                                    </i:EventTrigger>
                                                    <i:EventTrigger EventName="Checked">
                                                        <i:InvokeCommandAction Command="{Binding DataContext.Checked, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}">
                                                            <i:InvokeCommandAction.CommandParameter>
                                                                <MultiBinding Converter="{StaticResource MultiParamConverter}">
                                                                    <Binding />
                                                                    <Binding ElementName="CKB_DIETA" />
                                                                    <Binding />
                                                                </MultiBinding>
                                                            </i:InvokeCommandAction.CommandParameter>
                                                        </i:InvokeCommandAction>
                                                    </i:EventTrigger>
                                                </i:Interaction.Triggers>
                                            </CheckBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <GroupBox Grid.Row="6" Header="Dietas Canceladas">
                            <DataGrid AutoGenerateColumns="False" CanUserAddRows="False" SelectionMode="Single" ItemsSource="{Binding ListHistorialDietas}" Height="150" SelectionUnit="FullRow" IsReadOnly="True"
                              Style="{StaticResource MetroDataGrid}">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Descripción" Binding="{Binding DIETA.DESCR}"></DataGridTextColumn>
                                    <DataGridTextColumn Header="Fecha" Binding="{Binding DIETA_FEC}"></DataGridTextColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </GroupBox>
                        <!--<Label Grid.Row="5" Grid.Column="0" Content="Observaciones" Grid.ColumnSpan="3" Visibility="{Binding ObservacionesTratamientoVisible}"></Label>
                        <TextBox Grid.Row="6" Height="75" AcceptsReturn="True" Text="{Binding TextObservacionesConclusionesCertificado,UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper" TextWrapping="Wrap"
                         Width="{Binding ActualWidth, ConverterParameter=x-1, Converter={Views:MathConverter}, ElementName=lbDiagnostico}" Visibility="{Binding ObservacionesTratamientoVisible}"></TextBox>-->
                    </Grid>
                </Expander>
                <Expander Grid.Row="8" Grid.Column="0" Header="Procedimientos Medicos" Visibility="{Binding ProcedimientosMedicosVisible}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="300"></ColumnDefinition>
                            <ColumnDefinition Width="150"></ColumnDefinition>
                            <ColumnDefinition Width="*"></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                            <RowDefinition></RowDefinition>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.RowSpan="4">
                            <Label Grid.Row="0" Content="Clasificacion de Procedimiento"></Label>
                            <ComboBox Grid.Row="1" ItemsSource="{Binding ListProcedimientoSubtipo}" DisplayMemberPath="DESCR" SelectedValuePath="ID_PROCMED_SUBTIPO" SelectedItem="{Binding SelectProcedimientoSubtipo}"></ComboBox>
                            <Label Grid.Row="2" Content="Procedimiento Médico"></Label>
                            <ComboBox Grid.Row="3" ItemsSource="{Binding ListProcedimientoMedicoHijo}" DisplayMemberPath="DESCR" SelectedValuePath="ID_PROCMED" SelectedItem="{Binding SelectProcedimientoMedicoHijo}"></ComboBox>
                        </StackPanel>

                        <Label Name="lbProcMeds" Grid.Column="2"></Label>
                        <DataGrid Grid.Row="0" Grid.Column="2" Grid.RowSpan="4" MinHeight="100" MaxHeight="200" Background="WhiteSmoke" AutoGenerateColumns="False" Name="dgProcedimientosMedicos" CanUserAddRows="False" 
                                  ItemsSource="{Binding ListProcMedsSeleccionados}" SelectedItem="{Binding SelectProcMedSeleccionado}" IsReadOnly="False" Style="{StaticResource MetroDataGrid}" >
                            <DataGrid.Columns>
                                <!--<DataGridTextColumn Header="Fecha" Binding="{Binding AGENDA}" IsReadOnly="True"></DataGridTextColumn>-->
                                <DataGridTextColumn Header="Descripción" Binding="{Binding PROC_MED_DESCR}" IsReadOnly="True"></DataGridTextColumn>
                                <DataGridTemplateColumn Header="Agenda" IsReadOnly="False">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Button Content="Agendar" HorizontalAlignment="Right" VerticalAlignment="Center" Width="93" Margin="5" Command="{Binding DataContext.OnClick,RelativeSource={RelativeSource AncestorType=DataGrid}}" 
                                                        CommandParameter="{Binding}" Style="{DynamicResource AccentedSquareButtonStyle}" Focusable="True" />
                                                <TextBlock Margin="10 0 0 0" Text="{Binding AGENDA}" TextWrapping="NoWrap"></TextBlock>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTemplateColumn Header="Observaciones" IsReadOnly="False">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBox Text="{Binding OBSERV,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" CharacterCasing="Upper" MaxLength="500"></TextBox>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                            <!--<DataGrid.InputBindings>
                                <MouseBinding Gesture="LeftDoubleClick" Command="{Binding OnClick}" CommandParameter="{Binding ElementName=dgProcedimientosMedicos}"></MouseBinding>
                            </DataGrid.InputBindings>
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Eliminar" Command="{Binding OnClick}" CommandParameter="eliminar_receta" IsEnabled="{Binding ENABLE}" />
                                </ContextMenu>
                            </DataGrid.ContextMenu>-->
                        </DataGrid>

                        <Label Grid.Column="0" Grid.Row="4" Content="Historial"></Label>
                        <DataGrid Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3" MinHeight="100" MaxHeight="200" Background="WhiteSmoke" AutoGenerateColumns="False" Name="dgHistorialProcedimientosMedicos" CanUserAddRows="False" 
                                  ItemsSource="{Binding ListHistorialProcMeds}" SelectedItem="{Binding SelectHistorialProcMed}" IsReadOnly="True" Style="{StaticResource MetroDataGrid}" >
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Fecha" Binding="{Binding AGENDA}" IsReadOnly="True"></DataGridTextColumn>
                                <DataGridTextColumn Header="Descripción" Binding="{Binding PROC_MED_DESCR}" IsReadOnly="True"></DataGridTextColumn>
                                <DataGridTextColumn Header="Observaciones" Binding="{Binding OBSERV}" IsReadOnly="False"></DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                        <Button Grid.Column="1" Grid.Row="0" Grid.RowSpan="2" HorizontalAlignment="Center" VerticalAlignment="Center" Width="100" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="10,0,10,0"
                                CommandParameter="agregar_procedimiento_medico" Command="{Binding OnClick}">agregar -- ></Button>
                        <Button Grid.Column="1" Grid.Row="2" Grid.RowSpan="2" HorizontalAlignment="Center" VerticalAlignment="Top" Width="100" Style="{DynamicResource AccentedSquareButtonStyle}" Margin="10,0,10,0"
                                CommandParameter="remove_procedimiento_medico" Command="{Binding OnClick}" IsEnabled="{Binding EliminarProcedimientoMedicoEnabled}">&lt; -- quitar</Button>
                    </Grid>
                </Expander>
            </Grid>
        </StackPanel>
    </Grid>
</UserControl>
